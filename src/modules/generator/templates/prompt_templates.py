"""
–®–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π.
–°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π –∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤.
"""
from typing import Dict, Any, List, Optional
from datetime import date


class PromptTemplates:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏ –ø—Ä–æ–º–ø—Ç–æ–≤."""
    
    # –ë–∞–∑–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è
    BIRTHDAY_TEMPLATES = {
        "vip": {
            "name": "VIP –∫–ª–∏–µ–Ω—Ç - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–Ω",
            "template": """–°–æ–∑–¥–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ, –Ω–æ —Ç–µ–ø–ª–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –î–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è –¥–ª—è VIP-–∫–ª–∏–µ–Ω—Ç–∞ –±–∞–Ω–∫–∞.

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ:
- –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è: {full_name}
- –ö–æ–º–ø–∞–Ω–∏—è: {company}
- –î–æ–ª–∂–Ω–æ—Å—Ç—å: {position}
- –°–µ–≥–º–µ–Ω—Ç: {segment}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –û–±—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ "–í—ã"
2. –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
3. –ü–æ–∂–µ–ª–∞–Ω–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —É—Å–ø–µ—Ö–æ–≤ –∏ –ª–∏—á–Ω–æ–≥–æ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è
4. –î–ª–∏–Ω–∞: 4-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
5. –¢–æ–Ω: —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ —Å —Ç–µ–ø–ª–æ—Ç–æ–π

–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
1. –û–±—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
2. –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞/–∫–æ–º–ø–∞–Ω–∏–∏
3. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
4. –õ–∏—á–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
5. –ó–∞–≤–µ—Ä—à–∞—é—â–∞—è —Ñ—Ä–∞–∑–∞

–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ:""",
            "description": "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è VIP-–∫–ª–∏–µ–Ω—Ç–æ–≤"
        },
        
        "loyal": {
            "name": "–õ–æ—è–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç - –¥—Ä—É–∂–µ—Å–∫–∏–π —Ç–æ–Ω",
            "template": """–ù–∞–ø–∏—à–∏—Ç–µ –¥—Ä—É–∂–µ—Å–∫–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –î–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –±–∞–Ω–∫–∞.

–û –∫–ª–∏–µ–Ω—Ç–µ:
- –ò–º—è: {first_name}
- –§–∞–º–∏–ª–∏—è: {last_name}
- –ö–æ–º–ø–∞–Ω–∏—è: {company}
- –ú—ã —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞–µ–º —É–∂–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ "—Ç—ã" –∏–ª–∏ "–≤—ã" –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –£–ø–æ–º—è–Ω–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞
- –î–æ–±–∞–≤—å—Ç–µ —Ç–µ–ø–ª—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
- –î–ª–∏–Ω–∞: 3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –¢–æ–Ω: –¥—Ä—É–∂–µ—Å–∫–∏–π, –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã–π, —Ç–µ–ø–ª—ã–π

–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ:""",
            "description": "–î—Ä—É–∂–µ—Å–∫–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ª–æ—è–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤"
        },
        
        "new": {
            "name": "–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–Ω",
            "template": """–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –î–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –±–∞–Ω–∫–∞.

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- –ò–º—è: {first_name}
- –ú—ã –Ω–µ–¥–∞–≤–Ω–æ –Ω–∞—á–∞–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ

–ó–∞–¥–∞—á–∏:
1. –ü–æ–∑–¥—Ä–∞–≤–∏—Ç—å —Å –î–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è
2. –í—ã—Ä–∞–∑–∏—Ç—å —Ä–∞–¥–æ—Å—Ç—å –æ—Ç –Ω–∞—á–∞–ª–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞
3. –ü–æ–∂–µ–ª–∞—Ç—å —É—Å–ø–µ—Ö–æ–≤ –≤ –±–∏–∑–Ω–µ—Å–µ
4. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–º–æ—â—å –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö
5. –î–ª–∏–Ω–∞: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
6. –¢–æ–Ω: –ø—Ä–∏–≤–µ—Ç–ª–∏–≤—ã–π, –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π

–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ:""",
            "description": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤"
        },
        
        "default": {
            "name": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ",
            "template": """–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {full_name}!

–û—Ç –∏–º–µ–Ω–∏ –≤—Å–µ–≥–æ –°–±–µ—Ä–±–∞–Ω–∫–∞ –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –í–∞—Å —Å –î–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è!

–ñ–µ–ª–∞–µ–º –í–∞–º –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, —Å—á–∞—Å—Ç—å—è, –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è –∏ –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è –í–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.

–ü—É—Å—Ç—å –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Ä–µ—à–∞—é—Ç—Å—è –ª–µ–≥–∫–æ, –∞ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –Ω–∞—à–∏–º –±–∞–Ω–∫–æ–º –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑—É.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–ö–æ–º–∞–Ω–¥–∞ –°–±–µ—Ä–∞""",
            "description": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤"
        }
    }
    
    # –®–∞–±–ª–æ–Ω—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ (–±—É–¥–µ–º —Ä–∞—Å—à–∏—Ä—è—Ç—å)
    PROFESSIONAL_TEMPLATES = {
        "default": {
            "name": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫",
            "template": """–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {full_name}!

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –í–∞—Å —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º - {holiday_name}!

–ñ–µ–ª–∞–µ–º —É—Å–ø–µ—Ö–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ, –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–ö–æ–º–∞–Ω–¥–∞ –°–±–µ—Ä–∞""",
            "description": "–®–∞–±–ª–æ–Ω –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤"
        }
    }
    
    @classmethod
    def get_birthday_template(cls, segment: str = None) -> Dict[str, Any]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É –∫–ª–∏–µ–Ω—Ç–∞.
        
        Args:
            segment: –°–µ–≥–º–µ–Ω—Ç –∫–ª–∏–µ–Ω—Ç–∞ (vip, loyal, new)
            
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å —à–∞–±–ª–æ–Ω–æ–º
        """
        segment_key = segment.lower() if segment else "default"
        
        if segment_key not in cls.BIRTHDAY_TEMPLATES:
            segment_key = "default"
        
        return cls.BIRTHDAY_TEMPLATES[segment_key]
    
    @classmethod
    def get_template_by_event_type(cls, event_type: str, segment: str = None) -> Dict[str, Any]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –ø–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è.
        
        Args:
            event_type: –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (birthday, professional, holiday)
            segment: –°–µ–≥–º–µ–Ω—Ç –∫–ª–∏–µ–Ω—Ç–∞
            
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å —à–∞–±–ª–æ–Ω–æ–º
        """
        if event_type == "birthday":
            return cls.get_birthday_template(segment)
        elif event_type == "professional":
            return cls.PROFESSIONAL_TEMPLATES.get("default", cls.PROFESSIONAL_TEMPLATES["default"])
        else:
            return cls.BIRTHDAY_TEMPLATES["default"]
    
    @classmethod
    def format_template(cls, template: Dict[str, Any], context: Dict[str, Any]) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
        
        Args:
            template: –®–∞–±–ª–æ–Ω —Å –ø–æ–ª–µ–º 'template'
            context: –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏
            
        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
        """
        template_text = template["template"]
        
        # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞: –µ—Å–ª–∏ –∫–ª—é—á –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
        for key, value in context.items():
            placeholder = "{" + key + "}"
            if placeholder in template_text:
                template_text = template_text.replace(placeholder, str(value))
        
        # –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
        import re
        template_text = re.sub(r'\{[^}]*\}', '', template_text)
        
        return template_text.strip()
    
    @classmethod
    def list_all_templates(cls) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤.
        
        Returns:
            –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
        """
        templates = []
        
        # –î–æ–±–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω—ã –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è
        for key, template in cls.BIRTHDAY_TEMPLATES.items():
            templates.append({
                "type": "birthday",
                "key": key,
                "name": template["name"],
                "description": template["description"],
                "preview": template["template"][:100] + "..."
            })
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
        for key, template in cls.PROFESSIONAL_TEMPLATES.items():
            templates.append({
                "type": "professional",
                "key": key,
                "name": template["name"],
                "description": template["description"],
                "preview": template["template"][:100] + "..."
            })
        
        return templates


# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤:")
    
    # –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    context = {
        "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ò–≤–∞–Ω–æ–≤",
        "company": "–û–û–û '–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞'",
        "position": "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä",
        "segment": "VIP"
    }
    
    # –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω –¥–ª—è VIP –∫–ª–∏–µ–Ω—Ç–∞
    template = PromptTemplates.get_birthday_template("vip")
    print(f"\n1. –®–∞–±–ª–æ–Ω –¥–ª—è VIP: {template['name']}")
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
    formatted = PromptTemplates.format_template(template, context)
    print(f"\2. –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤):")
    print(formatted[:200] + "...")
    
    # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤
    templates_list = PromptTemplates.list_all_templates()
    print(f"\n3. –í—Å–µ–≥–æ —à–∞–±–ª–æ–Ω–æ–≤: {len(templates_list)}")
    for t in templates_list[:3]:
        print(f"   - {t['type']}.{t['key']}: {t['name']}")